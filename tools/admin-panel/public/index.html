<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Admin panel for Raspberry Pi 5 management and monitoring">
    <meta name="theme-color" content="#3b82f6">
    <title>PI5 Control Center</title>

    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icon-192.png">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/components/network.css">
    <link rel="stylesheet" href="/css/components/docker.css">
    <link rel="stylesheet" href="/css/components/ssh-tunnels.css">
    <link rel="stylesheet" href="/css/components/quick-launch.css">
    <link rel="stylesheet" href="/css/components/scripts-sidebar.css">
    <link rel="stylesheet" href="/css/components/scripts-enhancements.css">
    <link rel="stylesheet" href="/css/components/updates.css">
    <!-- Compact UI Override - Load LAST to override all sizes -->
    <link rel="stylesheet" href="/css/components/compact-override.css">
    <!-- Responsive Design - Mobile First -->
    <link rel="stylesheet" href="/css/responsive.css">
    <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="header-title">
                    <h1>
                        <i data-lucide="rocket" size="24"></i>
                        <span>PI5 Control Center</span>
                    </h1>
                    <div class="header-health" id="header-health">
                        <div class="health-badge" id="health-ssh" data-state="loading">
                            <i data-lucide="shield-check" size="16"></i>
                            <div class="health-text">
                                <span class="label">SSH</span>
                                <span class="value status" id="ssh-status">Connexion...</span>
                            </div>
                        </div>
                        <div class="health-badge" id="health-system" data-state="loading">
                            <i data-lucide="cpu" size="16"></i>
                            <div class="health-text">
                                <span class="label">Système</span>
                                <span class="value" id="health-system-value">--</span>
                            </div>
                        </div>
                        <div class="health-badge" id="health-docker" data-state="loading">
                            <i data-lucide="boxes" size="16"></i>
                            <div class="health-text">
                                <span class="label">Docker</span>
                                <span class="value" id="health-docker-value">--</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="header-stats">
                    <!-- Pi Selector -->
                    <div class="pi-selector">
                        <label>
                            <i data-lucide="monitor" size="16"></i>
                            <span>Pi :</span>
                        </label>
                        <select id="pi-selector" class="pi-select">
                            <option value="">Chargement...</option>
                        </select>
                    </div>
                    <div class="header-stat">
                        <i data-lucide="hash" size="16"></i>
                        <div class="stat-text">
                            <span class="label">Version</span>
                            <span class="value" id="app-version">--</span>
                        </div>
                    </div>
                    <!-- Power Controls -->
                    <div class="power-controls">
                        <button id="btn-add-pi" class="btn-power btn-add-pi" title="Ajouter un Pi">
                            <i data-lucide="plus-circle" size="18"></i>
                        </button>
                        <button id="toggle-terminal-sidebar" class="btn-power btn-terminal" title="Afficher le terminal">
                            <i data-lucide="terminal" size="18"></i>
                        </button>
                        <button id="btn-reboot" class="btn-power btn-reboot" title="Redémarrer le Pi">
                            <i data-lucide="rotate-cw" size="18"></i>
                        </button>
                        <button id="btn-shutdown" class="btn-power btn-shutdown" title="Arrêter le Pi">
                            <i data-lucide="power" size="18"></i>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="tabs">
            <button class="tab active" data-tab="dashboard" data-tooltip="Vue d'ensemble du système">
                <i data-lucide="layout-dashboard" size="18"></i>
                <span>Dashboard</span>
            </button>
            <button class="tab" data-tab="installation" data-tooltip="Assistant d'installation guidée">
                <i data-lucide="clapperboard" size="18"></i>
                <span>Installation</span>
            </button>
            <button class="tab" data-tab="scripts" data-tooltip="Exécuter des scripts de déploiement">
                <i data-lucide="scroll-text" size="18"></i>
                <span>Scripts</span>
            </button>
            <button class="tab" data-tab="network" data-tooltip="Gestion réseau et interfaces">
                <i data-lucide="globe-2" size="18"></i>
                <span>Réseau</span>
            </button>
            <button class="tab" data-tab="docker" data-tooltip="Gérer les conteneurs Docker">
                <i data-lucide="ship-wheel" size="18"></i>
                <span>Docker</span>
            </button>
            <button class="tab" data-tab="info" data-tooltip="Informations et services système">
                <i data-lucide="square-chart-gantt" size="18"></i>
                <span>Info</span>
            </button>
            <button class="tab" data-tab="history" data-tooltip="Historique des commandes exécutées">
                <i data-lucide="clock-3" size="18"></i>
                <span>Historique</span>
            </button>
            <button class="tab" data-tab="scheduler" data-tooltip="Planifier des tâches automatiques">
                <i data-lucide="calendar-clock" size="18"></i>
                <span>Planificateur</span>
            </button>
            <button class="tab" data-tab="ssh-tunnels" data-tooltip="Tunnels SSH et redirections de ports">
                <i data-lucide="network" size="18"></i>
                <span>SSH Tunnels</span>
            </button>
            <button class="tab" data-tab="database" data-tooltip="Configuration et audit de sécurité des bases de données">
                <i data-lucide="database" size="18"></i>
                <span>Database</span>
            </button>
            <button class="tab" data-tab="updates" data-tooltip="Gérer les mises à jour des services et dépendances">
                <i data-lucide="refresh-cw" size="18"></i>
                <span>Updates</span>
            </button>
            <button class="tab tab-action" id="toggle-focus-mode" type="button" aria-pressed="false" data-tooltip="Masquer les sections secondaires">
                <i data-lucide="focus" size="18"></i>
                <span>Mode focus</span>
            </button>
        </nav>

        <!-- Main Content - Single Column Layout -->
        <div class="single-column-layout">
            <div class="main-content">
            <!-- Installation Tab -->
            <div class="tab-content" id="installation-content">
                <section class="panel assistant-panel-full" data-focus="primary">
                    <div class="panel-header">
                        <h2><i data-lucide="bot" size="18"></i> Assistant d'installation</h2>
                        <button id="open-terminal-hint" class="btn btn-sm btn-primary">
                            <i data-lucide="terminal" size="14"></i>
                            <span>Ouvrir le terminal</span>
                        </button>
                    </div>

                    <!-- Progress Bar -->
                    <div class="installation-progress">
                        <div class="progress-header">
                            <h3>Progression</h3>
                            <span class="progress-percent" id="install-progress-percent">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="install-progress-fill" style="width: 0%"></div>
                        </div>
                        <div class="progress-steps" id="install-progress-steps">
                            <!-- Will be populated by JS -->
                        </div>
                    </div>

                    <!-- Assistant Messages -->
                    <div class="assistant-messages" id="assistant-messages">
                        <div class="message assistant-message">
                            <div class="message-avatar">
                                <i data-lucide="bot" size="20"></i>
                            </div>
                            <div class="message-content">
                                <div class="message-text">Bienvenue ! Je vais t'aider à installer et configurer ton Pi étape par étape. 🚀</div>
                                <div class="message-text">💡 <strong>Astuce :</strong> Clique sur le bouton <kbd>💻 Terminal</kbd> en haut à droite (ou appuie sur <kbd>Ctrl+`</kbd>) pour ouvrir le terminal.</div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Dashboard Tab -->
            <div class="tab-content active" id="dashboard-content">
                <div class="dashboard-grid">
                    <!-- Overview Summary -->
                    <section class="panel summary-panel" data-focus="primary">
                        <div class="panel-header">
                            <h2><i data-lucide="activity-square" size="18"></i> Vue d'ensemble</h2>
                            <div class="panel-actions">
                                <button class="btn btn-sm btn-ghost" id="refresh-summary">
                                    <i data-lucide="refresh-cw" size="14"></i>
                                    <span>Actualiser</span>
                                </button>
                            </div>
                        </div>
                        <div class="summary-grid">
                            <div class="summary-card" id="summary-pi">
                                <div class="summary-label">Pi actif</div>
                                <div class="summary-value" id="summary-pi-value">--</div>
                                <div class="summary-meta" id="summary-pi-meta">Sélectionnez un Pi pour commencer</div>
                            </div>
                            <div class="summary-card" id="summary-alerts">
                                <div class="summary-label">Alertes</div>
                                <div class="summary-value" id="summary-alerts-value">0</div>
                                <div class="summary-meta" id="summary-alerts-meta">Aucune alerte détectée</div>
                            </div>
                            <div class="summary-card" id="summary-next-task">
                                <div class="summary-label">Prochaine tâche</div>
                                <div class="summary-value" id="summary-task-value">--</div>
                                <div class="summary-meta" id="summary-task-meta">Planification en attente</div>
                            </div>
                        </div>
                    </section>

                    <!-- Quick Launch Services -->
                    <section class="panel quick-launch-panel" data-focus="primary">
                        <div class="panel-header">
                            <h2>
                                <i data-lucide="rocket" size="18"></i>
                                <span>Quick Launch</span>
                            </h2>
                            <div class="panel-actions">
                                <button class="btn btn-sm btn-ghost" id="refresh-services">
                                    <i data-lucide="refresh-cw" size="14"></i>
                                    <span>Actualiser</span>
                                </button>
                            </div>
                        </div>
                        <div id="quick-launch-grid" class="quick-launch-grid">
                            <!-- Services will be populated by JS -->
                            <div class="quick-launch-empty">
                                <i data-lucide="loader" size="32"></i>
                                <p>Détection des services...</p>
                            </div>
                        </div>
                    </section>

                    <!-- System Charts (Full Width) -->
                    <section class="panel chart-panel" data-focus="primary">
                        <div class="panel-header">
                            <h2><i data-lucide="activity" size="18"></i> Performance en temps réel</h2>
                            <div class="chart-controls">
                                <button class="btn btn-sm" id="chart-timerange" data-range="5m">5m</button>
                            </div>
                        </div>
                        <div class="charts-grid">
                            <div class="chart-container">
                                <canvas id="cpu-chart"></canvas>
                            </div>
                            <div class="chart-container">
                                <canvas id="ram-chart"></canvas>
                            </div>
                            <div class="chart-container">
                                <canvas id="temp-chart"></canvas>
                            </div>
                        </div>
                    </section>

                    <!-- System Stats -->
                    <section class="panel stat-card" data-focus="primary">
                        <h2><i data-lucide="cpu" size="18"></i> Système</h2>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-label">CPU</div>
                                <div class="stat-value" id="stat-cpu">
                                    <div class="progress-ring">
                                        <span class="percent">--</span>
                                    </div>
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">RAM</div>
                                <div class="stat-value" id="stat-ram">
                                    <div class="progress-ring">
                                        <span class="percent">--</span>
                                    </div>
                                    <div class="stat-detail">-- / -- GB</div>
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Température</div>
                                <div class="stat-value" id="stat-temp">
                                    <div class="temp-display">--°C</div>
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Disque</div>
                                <div class="stat-value" id="stat-disk">
                                    <div class="progress-ring">
                                        <span class="percent">--</span>
                                    </div>
                                    <div class="stat-detail">-- / --</div>
                                </div>
                            </div>
                        </div>
                        <div class="uptime">
                            <i data-lucide="timer" size="16"></i>
                            <span class="label">Uptime</span>
                            <span class="value" id="stat-uptime">--</span>
                        </div>
                    </section>

                    <!-- Docker Services -->
                    <section class="panel" data-focus="primary">
                        <div class="panel-header">
                            <h2><i data-lucide="boxes" size="18"></i> Services Docker</h2>
                            <button id="refresh-docker-dash" class="btn btn-sm" title="Actualiser les services Docker">
                                <i data-lucide="refresh-cw" size="14"></i>
                            </button>
                        </div>
                        <div id="docker-services-dash" class="service-list">
                            <div class="loading-skeleton">
                                <div class="skeleton-service-item">
                                    <div class="skeleton skeleton-avatar"></div>
                                    <div class="skeleton-service-content">
                                        <div class="skeleton skeleton-text short"></div>
                                        <div class="skeleton skeleton-text medium"></div>
                                    </div>
                                </div>
                                <div class="skeleton-service-item">
                                    <div class="skeleton skeleton-avatar"></div>
                                    <div class="skeleton-service-content">
                                        <div class="skeleton skeleton-text short"></div>
                                        <div class="skeleton skeleton-text medium"></div>
                                    </div>
                                </div>
                                <div class="skeleton-service-item">
                                    <div class="skeleton skeleton-avatar"></div>
                                    <div class="skeleton-service-content">
                                        <div class="skeleton skeleton-text short"></div>
                                        <div class="skeleton skeleton-text medium"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Setup Wizard Checklist -->
                    <section class="panel setup-panel" data-focus="secondary">
                        <div class="panel-header">
                            <h2><i data-lucide="sliders-horizontal" size="18"></i> Configuration initiale</h2>
                            <button id="dismiss-setup" class="btn btn-sm btn-ghost" title="Masquer la configuration initiale">
                                <i data-lucide="x" size="14"></i>
                            </button>
                        </div>
                        <div class="setup-checklist">
                            <div class="setup-item" data-step="docker">
                                <div class="setup-status" aria-hidden="true">✅</div>
                                <div class="setup-info">
                                    <div class="setup-title">Docker installé</div>
                                    <div class="setup-desc">Environnement conteneurisé prêt</div>
                                </div>
                            </div>
                            <div class="setup-item" data-step="network">
                                <div class="setup-status" aria-hidden="true">⏸️</div>
                                <div class="setup-info">
                                    <div class="setup-title">Configuration réseau</div>
                                    <div class="setup-desc">IP statique, hostname, DNS</div>
                                </div>
                                <button class="btn btn-sm btn-primary" onclick="quickSetupNetwork()">
                                    <i data-lucide="settings" size="14"></i>
                                    <span>Configurer</span>
                                </button>
                            </div>
                            <div class="setup-item" data-step="security">
                                <div class="setup-status" aria-hidden="true">⏸️</div>
                                <div class="setup-info">
                                    <div class="setup-title">Sécurité de base</div>
                                    <div class="setup-desc">UFW, Fail2ban, SSH hardening</div>
                                </div>
                                <button class="btn btn-sm btn-primary" onclick="quickSetupSecurity()">
                                    <i data-lucide="shield" size="14"></i>
                                    <span>Configurer</span>
                                </button>
                            </div>
                            <div class="setup-item" data-step="traefik">
                                <div class="setup-status" aria-hidden="true">⏸️</div>
                                <div class="setup-info">
                                    <div class="setup-title">Reverse Proxy (Traefik)</div>
                                    <div class="setup-desc">Routage et certificats SSL</div>
                                </div>
                                <button class="btn btn-sm btn-primary" onclick="quickSetupTraefik()">
                                    <i data-lucide="router" size="14"></i>
                                    <span>Installer</span>
                                </button>
                            </div>
                            <div class="setup-item" data-step="monitoring">
                                <div class="setup-status" aria-hidden="true">⏸️</div>
                                <div class="setup-info">
                                    <div class="setup-title">Monitoring (Prometheus + Grafana)</div>
                                    <div class="setup-desc">Supervision et métriques</div>
                                </div>
                                <button class="btn btn-sm btn-primary" onclick="quickSetupMonitoring()">
                                    <i data-lucide="bar-chart-3" size="14"></i>
                                    <span>Installer</span>
                                </button>
                            </div>
                        </div>
                        <div class="setup-footer">
                            <span class="setup-progress">1/5 étapes complétées</span>
                        </div>
                    </section>

                    <!-- Pi Credentials -->
                    <section class="panel" data-focus="secondary">
                        <div class="panel-header">
                            <h2><i data-lucide="key-round" size="18"></i> Identifiants Pi</h2>
                            <button id="toggle-credentials" class="btn btn-sm">
                                <i data-lucide="eye" size="14"></i>
                                <span>Afficher</span>
                            </button>
                        </div>
                        <div id="pi-credentials" class="credentials-container hidden">
                            <div class="loading">Chargement...</div>
                        </div>
                    </section>

                    <!-- Quick Actions -->
                    <section class="panel" data-focus="secondary">
                        <h2><i data-lucide="zap" size="18"></i> Actions rapides</h2>
                        <div class="quick-actions">
                            <button class="action-btn" data-action="backup">
                                <span class="icon">
                                    <i data-lucide="hard-drive" size="18"></i>
                                </span>
                                <span class="label">Backup All</span>
                            </button>
                            <button class="action-btn" data-action="healthcheck">
                                <span class="icon">
                                    <i data-lucide="stethoscope" size="18"></i>
                                </span>
                                <span class="label">Healthcheck</span>
                            </button>
                            <button class="action-btn" data-action="security">
                                <span class="icon">
                                    <i data-lucide="shield-check" size="18"></i>
                                </span>
                                <span class="label">Security Scan</span>
                            </button>
                            <button class="action-btn" data-action="update">
                                <span class="icon">
                                    <i data-lucide="refresh-cw" size="18"></i>
                                </span>
                                <span class="label">Update All</span>
                            </button>
                        </div>
                    </section>

                </div>
            </div>

            <!-- Scripts Tab (Sidebar Navigation) -->
            <div class="tab-content" id="scripts-content">
                <div class="scripts-container">
                    <!-- Sidebar -->
                    <aside class="scripts-sidebar">
                        <div class="scripts-sidebar-header">
                            <h3>
                                <i data-lucide="folder-tree" size="14"></i>
                                <span>Catégories</span>
                            </h3>
                        </div>

                        <!-- Search -->
                        <div class="sidebar-search">
                            <input type="text" id="search-scripts" placeholder="Rechercher...">
                        </div>

                        <!-- All Scripts -->
                        <button class="category-item active" data-category="all">
                            <i data-lucide="layout-grid" size="14"></i>
                            <span class="category-name">Tous les scripts</span>
                            <span class="category-count" id="count-all">0</span>
                        </button>

                        <!-- Hierarchical Categories with Stacks -->
                        <div class="categories-hierarchical">
                            <!-- Infrastructure -->
                            <div class="category-group">
                                <button class="category-item category-parent" data-category="infrastructure">
                                    <i data-lucide="chevron-right" size="12" class="category-chevron"></i>
                                    <i data-lucide="server" size="14"></i>
                                    <span class="category-name">Infrastructure</span>
                                    <span class="category-count" id="count-infrastructure">0</span>
                                </button>
                                <div class="category-stacks" data-parent="infrastructure">
                                    <button class="stack-item" data-stack="supabase" data-category="infrastructure"><i data-lucide="database" size="12"></i> Supabase</button>
                                    <button class="stack-item" data-stack="traefik" data-category="infrastructure"><i data-lucide="globe" size="12"></i> Traefik</button>
                                    <button class="stack-item" data-stack="email" data-category="infrastructure"><i data-lucide="mail" size="12"></i> Email</button>
                                    <button class="stack-item" data-stack="appwrite" data-category="infrastructure"><i data-lucide="rocket" size="12"></i> Appwrite</button>
                                    <button class="stack-item" data-stack="pocketbase" data-category="infrastructure"><i data-lucide="archive" size="12"></i> Pocketbase</button>
                                    <button class="stack-item" data-stack="vaultwarden" data-category="infrastructure"><i data-lucide="shield-check" size="12"></i> Vaultwarden</button>
                                    <button class="stack-item" data-stack="dashboard" data-category="infrastructure"><i data-lucide="monitor" size="12"></i> Dashboard</button>
                                    <button class="stack-item" data-stack="webserver" data-category="infrastructure"><i data-lucide="server" size="12"></i> Webserver</button>
                                    <button class="stack-item" data-stack="pihole" data-category="infrastructure"><i data-lucide="shield" size="12"></i> PiHole</button>
                                    <button class="stack-item" data-stack="vpn-wireguard" data-category="infrastructure"><i data-lucide="lock" size="12"></i> VPN</button>
                                    <button class="stack-item" data-stack="external-access" data-category="infrastructure"><i data-lucide="arrow-up-right" size="12"></i> External Access</button>
                                    <button class="stack-item" data-stack="apps" data-category="infrastructure"><i data-lucide="grid" size="12"></i> Apps</button>
                                </div>
                            </div>

                            <!-- Security -->
                            <div class="category-group">
                                <button class="category-item category-parent" data-category="security">
                                    <i data-lucide="chevron-right" size="12" class="category-chevron"></i>
                                    <i data-lucide="shield" size="14"></i>
                                    <span class="category-name">Sécurité</span>
                                    <span class="category-count" id="count-security">0</span>
                                </button>
                                <div class="category-stacks" data-parent="security">
                                    <button class="stack-item" data-stack="authelia" data-category="security"><i data-lucide="key" size="12"></i> Authelia</button>
                                    <button class="stack-item" data-stack="passwords" data-category="security"><i data-lucide="lock" size="12"></i> Passwords</button>
                                    <button class="stack-item" data-stack="hardening" data-category="security"><i data-lucide="shield-check" size="12"></i> Hardening</button>
                                </div>
                            </div>

                            <!-- Monitoring -->
                            <div class="category-group">
                                <button class="category-item category-parent" data-category="monitoring">
                                    <i data-lucide="chevron-right" size="12" class="category-chevron"></i>
                                    <i data-lucide="activity" size="14"></i>
                                    <span class="category-name">Monitoring</span>
                                    <span class="category-count" id="count-monitoring">0</span>
                                </button>
                                <div class="category-stacks" data-parent="monitoring">
                                    <button class="stack-item" data-stack="prometheus-grafana" data-category="monitoring"><i data-lucide="bar-chart" size="12"></i> Prometheus + Grafana</button>
                                    <button class="stack-item" data-stack="uptime-kuma" data-category="monitoring"><i data-lucide="check-circle" size="12"></i> Uptime Kuma</button>
                                </div>
                            </div>

                            <!-- Development -->
                            <div class="category-group">
                                <button class="category-item category-parent" data-category="development">
                                    <i data-lucide="chevron-right" size="12" class="category-chevron"></i>
                                    <i data-lucide="code" size="14"></i>
                                    <span class="category-name">Développement</span>
                                    <span class="category-count" id="count-development">0</span>
                                </button>
                                <div class="category-stacks" data-parent="development">
                                    <button class="stack-item" data-stack="gitea" data-category="development"><i data-lucide="git-branch" size="12"></i> Gitea</button>
                                </div>
                            </div>

                            <!-- Storage -->
                            <div class="category-group">
                                <button class="category-item category-parent" data-category="storage">
                                    <i data-lucide="chevron-right" size="12" class="category-chevron"></i>
                                    <i data-lucide="hard-drive" size="14"></i>
                                    <span class="category-name">Stockage</span>
                                    <span class="category-count" id="count-storage">0</span>
                                </button>
                                <div class="category-stacks" data-parent="storage">
                                    <button class="stack-item" data-stack="filebrowser-nextcloud" data-category="storage"><i data-lucide="folder" size="12"></i> FileBrowser + Nextcloud</button>
                                    <button class="stack-item" data-stack="syncthing" data-category="storage"><i data-lucide="refresh-cw" size="12"></i> Syncthing</button>
                                </div>
                            </div>

                            <!-- Media -->
                            <div class="category-group">
                                <button class="category-item category-parent" data-category="media">
                                    <i data-lucide="chevron-right" size="12" class="category-chevron"></i>
                                    <i data-lucide="film" size="14"></i>
                                    <span class="category-name">Média</span>
                                    <span class="category-count" id="count-media">0</span>
                                </button>
                                <div class="category-stacks" data-parent="media">
                                    <button class="stack-item" data-stack="jellyfin-arr" data-category="media"><i data-lucide="play-circle" size="12"></i> Jellyfin + Arr</button>
                                    <button class="stack-item" data-stack="navidrome" data-category="media"><i data-lucide="music" size="12"></i> Navidrome</button>
                                    <button class="stack-item" data-stack="calibre-web" data-category="media"><i data-lucide="book" size="12"></i> Calibre Web</button>
                                    <button class="stack-item" data-stack="qbittorrent" data-category="media"><i data-lucide="download" size="12"></i> qBittorrent</button>
                                </div>
                            </div>

                            <!-- Home Automation -->
                            <div class="category-group">
                                <button class="category-item category-parent" data-category="home-automation">
                                    <i data-lucide="chevron-right" size="12" class="category-chevron"></i>
                                    <i data-lucide="home" size="14"></i>
                                    <span class="category-name">Domotique</span>
                                    <span class="category-count" id="count-home-automation">0</span>
                                </button>
                                <div class="category-stacks" data-parent="home-automation">
                                    <button class="stack-item" data-stack="homeassistant" data-category="home-automation"><i data-lucide="zap" size="12"></i> Home Assistant</button>
                                </div>
                            </div>

                            <!-- Interface -->
                            <div class="category-group">
                                <button class="category-item category-parent" data-category="interface">
                                    <i data-lucide="chevron-right" size="12" class="category-chevron"></i>
                                    <i data-lucide="layout" size="14"></i>
                                    <span class="category-name">Interface</span>
                                    <span class="category-count" id="count-interface">0</span>
                                </button>
                                <div class="category-stacks" data-parent="interface">
                                    <button class="stack-item" data-stack="homepage" data-category="interface"><i data-lucide="home" size="12"></i> Homepage</button>
                                    <button class="stack-item" data-stack="portainer" data-category="interface"><i data-lucide="container" size="12"></i> Portainer</button>
                                </div>
                            </div>

                            <!-- Productivity -->
                            <div class="category-group">
                                <button class="category-item category-parent" data-category="productivity">
                                    <i data-lucide="chevron-right" size="12" class="category-chevron"></i>
                                    <i data-lucide="briefcase" size="14"></i>
                                    <span class="category-name">Productivité</span>
                                    <span class="category-count" id="count-productivity">0</span>
                                </button>
                                <div class="category-stacks" data-parent="productivity">
                                    <button class="stack-item" data-stack="paperless-ngx" data-category="productivity"><i data-lucide="file-text" size="12"></i> Paperless-NGX</button>
                                    <button class="stack-item" data-stack="immich" data-category="productivity"><i data-lucide="image" size="12"></i> Immich</button>
                                    <button class="stack-item" data-stack="joplin" data-category="productivity"><i data-lucide="clipboard" size="12"></i> Joplin</button>
                                </div>
                            </div>

                            <!-- AI -->
                            <div class="category-group">
                                <button class="category-item category-parent" data-category="ai">
                                    <i data-lucide="chevron-right" size="12" class="category-chevron"></i>
                                    <i data-lucide="cpu" size="14"></i>
                                    <span class="category-name">IA</span>
                                    <span class="category-count" id="count-ai">0</span>
                                </button>
                                <div class="category-stacks" data-parent="ai">
                                    <button class="stack-item" data-stack="n8n" data-category="ai"><i data-lucide="workflow" size="12"></i> N8N</button>
                                    <button class="stack-item" data-stack="ollama" data-category="ai"><i data-lucide="brain" size="12"></i> Ollama</button>
                                </div>
                            </div>

                            <!-- Backups -->
                            <div class="category-group">
                                <button class="category-item category-parent" data-category="backups">
                                    <i data-lucide="chevron-right" size="12" class="category-chevron"></i>
                                    <i data-lucide="archive" size="14"></i>
                                    <span class="category-name">Backups</span>
                                    <span class="category-count" id="count-backups">0</span>
                                </button>
                            <div class="category-stacks" data-parent="backups">
                                <button class="stack-item" data-stack="restic-offsite" data-category="backups"><i data-lucide="cloud-upload" size="12"></i> Restic Offsite</button>
                            </div>
                        </div>
                    </div>

                        <div class="sidebar-divider"></div>

                        <!-- Favorites & Recent Categories -->
                        <button class="category-item" data-category="favorites">
                            <i data-lucide="star" size="14"></i>
                            <span class="category-name">Favoris</span>
                            <span class="category-count" id="count-favorites">0</span>
                        </button>

                        <button class="category-item" data-category="recent">
                            <i data-lucide="clock" size="14"></i>
                            <span class="category-name">Récents</span>
                            <span class="category-count" id="count-recent">0</span>
                        </button>

                        <!-- Separator -->
                        <div style="height: 1px; background: var(--border); margin: 12px 0;"></div>

                        <!-- Action Types Categories -->
                        <div class="categories-list">
                            <div style="padding: 8px 8px 4px 8px; font-size: 10px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px;">Par Type d'Action</div>

                            <button class="category-item" data-category="type-deploy">
                                <i data-lucide="rocket" size="14"></i>
                                <span class="category-name">Deploy</span>
                                <span class="category-count" id="count-type-deploy">0</span>
                            </button>
                            <button class="category-item" data-category="type-maintenance">
                                <i data-lucide="wrench" size="14"></i>
                                <span class="category-name">Maintenance</span>
                                <span class="category-count" id="count-type-maintenance">0</span>
                            </button>
                            <button class="category-item" data-category="type-cleanup">
                                <i data-lucide="trash-2" size="14"></i>
                                <span class="category-name">Nettoyage</span>
                                <span class="category-count" id="count-type-cleanup">0</span>
                            </button>
                            <button class="category-item" data-category="type-credentials">
                                <i data-lucide="key" size="14"></i>
                                <span class="category-name">Identifiants</span>
                                <span class="category-count" id="count-type-credentials">0</span>
                            </button>
                            <button class="category-item" data-category="type-reset">
                                <i data-lucide="rotate-ccw" size="14"></i>
                                <span class="category-name">Réinitialisation</span>
                                <span class="category-count" id="count-type-reset">0</span>
                            </button>
                            <button class="category-item" data-category="type-utils">
                                <i data-lucide="settings" size="14"></i>
                                <span class="category-name">Utilitaires</span>
                                <span class="category-count" id="count-type-utils">0</span>
                            </button>
                            <button class="category-item" data-category="type-test">
                                <i data-lucide="flask-conical" size="14"></i>
                                <span class="category-name">Tests</span>
                                <span class="category-count" id="count-type-test">0</span>
                            </button>
                        </div>

                        <div class="sidebar-divider"></div>
                    </aside>

                    <!-- Main Content -->
                    <div class="scripts-main">
                        <div class="scripts-main-header">
                            <h2>
                                <i data-lucide="file-code" size="16"></i>
                                <span id="scripts-category-title">Tous les scripts</span>
                            </h2>
                            <div class="scripts-main-actions">
                                <button id="refresh-scripts" class="btn btn-sm">
                                    <i data-lucide="refresh-cw" size="12"></i>
                                    <span>Actualiser</span>
                                </button>
                            </div>
                        </div>

                        <div id="all-scripts" class="scripts-grid">
                            <div class="scripts-loading">
                                <i data-lucide="loader" size="24"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Network Tab -->
            <div class="tab-content" id="network-content">
                <div class="network-layout-sidebar">
                    <!-- Sidebar -->
                    <aside class="network-sidebar">
                        <div class="sidebar-header">
                            <h3>
                                <i data-lucide="network" size="18"></i>
                                <span>Supervision réseau</span>
                            </h3>
                            <p class="sidebar-description">
                                Navigation organisée par sections
                            </p>
                        </div>

                        <div class="sidebar-categories">
                            <button class="network-category-item active" data-network-category="overview">
                                <i data-lucide="layout-dashboard" size="14"></i>
                                <span class="category-name">Vue d'ensemble</span>
                            </button>
                            <button class="network-category-item" data-network-category="interfaces">
                                <i data-lucide="cable" size="14"></i>
                                <span class="category-name">Interfaces & Trafic</span>
                            </button>
                            <button class="network-category-item" data-network-category="ports">
                                <i data-lucide="plug" size="14"></i>
                                <span class="category-name">Ports & Connexions</span>
                            </button>
                            <button class="network-category-item" data-network-category="security">
                                <i data-lucide="shield" size="14"></i>
                                <span class="category-name">Sécurité</span>
                            </button>
                            <button class="network-category-item" data-network-category="diagnostics">
                                <i data-lucide="beaker" size="14"></i>
                                <span class="category-name">Tests & Diagnostics</span>
                            </button>
                        </div>
                    </aside>

                    <!-- Main Content -->
                    <div class="network-main">
                        <!-- Overview Section -->
                        <div class="network-section active" id="network-section-overview">
                            <div class="network-section-header">
                                <h2>
                                    <i data-lucide="layout-dashboard" size="20"></i>
                                    <span>Vue d'ensemble</span>
                                </h2>
                                <p class="section-description">
                                    État global de votre réseau en un coup d'œil
                                </p>
                            </div>

                            <div class="network-overview" id="network-overview">
                                <div class="network-summary-card" data-summary="connectivity" data-state="loading">
                                    <div class="summary-icon">🔌</div>
                                    <div class="summary-content">
                                        <h4>Connectivité</h4>
                                        <p id="network-summary-connection">Analyse en cours…</p>
                                    </div>
                                </div>
                                <div class="network-summary-card" data-summary="firewall" data-state="loading">
                                    <div class="summary-icon">🛡️</div>
                                    <div class="summary-content">
                                        <h4>Pare-feu</h4>
                                        <p id="network-summary-firewall">Analyse en cours…</p>
                                    </div>
                                </div>
                                <div class="network-summary-card" data-summary="ports" data-state="loading">
                                    <div class="summary-icon">📡</div>
                                    <div class="summary-content">
                                        <h4>Services exposés</h4>
                                        <p id="network-summary-ports">Analyse en cours…</p>
                                    </div>
                                </div>
                            </div>

                            <section class="panel">
                                <div class="panel-header">
                                    <h3><i data-lucide="activity" size="16"></i> Statistiques temps réel</h3>
                                    <div class="panel-header-actions">
                                        <select id="network-interface-selector-overview" class="form-select form-select-sm">
                                            <option value="eth0">eth0</option>
                                        </select>
                                    </div>
                                </div>
                                <div id="bandwidth-stats-overview">
                                    <div class="loading">Chargement des statistiques...</div>
                                </div>
                            </section>
                        </div>

                        <!-- Interfaces & Traffic Section -->
                        <div class="network-section" id="network-section-interfaces">
                            <div class="network-section-header">
                                <h2>
                                    <i data-lucide="cable" size="20"></i>
                                    <span>Interfaces & Trafic</span>
                                </h2>
                                <div class="section-actions">
                                    <label class="network-auto-refresh">
                                        <input type="checkbox" id="network-auto-refresh">
                                        <span>Auto-refresh</span>
                                    </label>
                                    <select id="network-interface-selector" class="form-select form-select-sm">
                                        <option value="eth0">eth0</option>
                                    </select>
                                    <button id="refresh-network" class="btn btn-sm" title="Rafraîchir les données réseau">
                                        <i data-lucide="refresh-cw" size="14"></i>
                                        <span>Rafraîchir</span>
                                    </button>
                                </div>
                            </div>

                            <section class="panel">
                                <div class="panel-header">
                                    <h3><i data-lucide="list" size="16"></i> Interfaces détectées</h3>
                                </div>
                                <div id="network-interfaces-traffic">
                                    <div class="loading">Chargement des interfaces...</div>
                                </div>
                            </section>

                            <section class="panel">
                                <div class="panel-header">
                                    <h3><i data-lucide="activity" size="16"></i> Statistiques temps réel</h3>
                                </div>
                                <div id="bandwidth-stats">
                                    <div class="loading">Chargement des statistiques...</div>
                                </div>
                            </section>
                        </div>

                        <!-- Ports & Connections Section -->
                        <div class="network-section" id="network-section-ports">
                            <div class="network-section-header">
                                <h2>
                                    <i data-lucide="plug" size="20"></i>
                                    <span>Ports & Connexions</span>
                                </h2>
                                <div class="section-actions">
                                    <button id="refresh-connections" class="btn btn-sm" title="Actualiser les connexions et ports">
                                        <i data-lucide="refresh-cw" size="14"></i>
                                        <span>Rafraîchir</span>
                                    </button>
                                </div>
                            </div>

                            <div class="port-management-grid">
                                <div class="port-column">
                                    <div class="port-block">
                                        <div class="port-block-header">
                                            <h4><i data-lucide="radio" size="16"></i> Ports exposés</h4>
                                        </div>
                                        <div class="port-filter">
                                            <i data-lucide="search" size="14"></i>
                                            <input type="search" id="port-filter" placeholder="Filtrer par port, service ou protocole…">
                                            <button id="clear-port-filter" class="btn-icon" type="button" title="Effacer le filtre">
                                                <i data-lucide="x" size="14"></i>
                                            </button>
                                        </div>
                                        <div id="listening-ports" class="port-scroll">
                                            <div class="loading">Chargement des ports...</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="port-column">
                                    <div class="port-block">
                                        <div class="port-block-header">
                                            <h4><i data-lucide="gauge" size="16"></i> Synthèse</h4>
                                        </div>
                                        <div id="port-usage-summary" class="port-summary">
                                            <div class="loading">Analyse des ports…</div>
                                        </div>
                                    </div>
                                    <div class="port-block">
                                        <div class="port-block-header">
                                            <h4><i data-lucide="activity" size="16"></i> Connexions actives</h4>
                                        </div>
                                        <div id="active-connections" class="port-scroll">
                                            <div class="loading">Chargement des connexions...</div>
                                        </div>
                                    </div>
                                    <div class="port-block">
                                        <div class="port-block-header">
                                            <h4><i data-lucide="sparkles" size="16"></i> Astuces rapides</h4>
                                        </div>
                                        <ul class="port-tips">
                                            <li>Double-cliquez sur un port pour le copier</li>
                                            <li>Utilisez <code>sudo lsof -i :PORT</code> pour identifier le processus</li>
                                            <li>Vérifiez vos règles UFW dans la section Sécurité</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Security Section -->
                        <div class="network-section" id="network-section-security">
                            <div class="network-section-header">
                                <h2>
                                    <i data-lucide="shield" size="20"></i>
                                    <span>Sécurité</span>
                                </h2>
                                <div class="section-actions">
                                    <button id="refresh-firewall" class="btn btn-sm" title="Actualiser le pare-feu">
                                        <i data-lucide="refresh-cw" size="14"></i>
                                        <span>Rafraîchir</span>
                                    </button>
                                </div>
                            </div>

                            <section class="panel">
                                <div class="panel-header">
                                    <h3><i data-lucide="map-pin" size="16"></i> IP publique & Localisation</h3>
                                </div>
                                <div id="public-ip-info">
                                    <div class="loading">Chargement de l'adresse IP...</div>
                                </div>
                            </section>

                            <section class="panel">
                                <div class="panel-header">
                                    <h3><i data-lucide="shield-alert" size="16"></i> Pare-feu (UFW)</h3>
                                </div>
                                <div id="firewall-status">
                                    <div class="loading">Chargement de l'état du pare-feu...</div>
                                </div>
                            </section>
                        </div>

                        <!-- Diagnostics Section -->
                        <div class="network-section" id="network-section-diagnostics">
                            <div class="network-section-header">
                                <h2>
                                    <i data-lucide="beaker" size="20"></i>
                                    <span>Tests & Diagnostics</span>
                                </h2>
                            </div>

                            <section class="panel">
                                <div class="panel-header">
                                    <h3><i data-lucide="signal" size="16"></i> Test de ping</h3>
                                </div>
                                <div class="network-test-form">
                                    <input type="text" id="ping-host" placeholder="Host (e.g., 8.8.8.8)" value="8.8.8.8">
                                    <input type="number" id="ping-count" placeholder="Count" value="4" min="1" max="10">
                                    <button id="test-ping-btn" class="btn btn-primary">
                                        <i data-lucide="activity" size="14"></i>
                                        <span>Lancer</span>
                                    </button>
                                </div>
                                <div id="ping-result"></div>
                            </section>

                            <section class="panel">
                                <div class="panel-header">
                                    <h3><i data-lucide="globe-lock" size="16"></i> Test DNS</h3>
                                </div>
                                <div class="network-test-form">
                                    <input type="text" id="dns-domain" placeholder="Domain (e.g., google.com)" value="google.com">
                                    <button id="test-dns-btn" class="btn btn-primary">
                                        <i data-lucide="search" size="14"></i>
                                        <span>Résoudre</span>
                                    </button>
                                </div>
                                <div id="dns-result"></div>
                            </section>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Docker Tab -->
            <div class="tab-content" id="docker-content">
                <div class="docker-manager">
                    <div class="docker-header">
                        <h2><i data-lucide="ship-wheel" size="20"></i> Gestion Docker</h2>
                        <button id="refresh-docker" class="btn">
                            <i data-lucide="refresh-cw" size="14"></i>
                            <span>Rafraîchir</span>
                        </button>
                    </div>
                    <div id="docker-container" class="docker-grid">
                        <div class="loading">Chargement des conteneurs...</div>
                    </div>
                </div>
            </div>


            <!-- Info Tab -->
            <div class="tab-content" id="info-content">
                <div class="info-container">
                    <div class="info-header">
                        <h2><i data-lucide="badge-help" size="20"></i> Services & identifiants</h2>
                        <div class="info-controls">
                            <select id="category-filter" class="filter-select">
                                <option value="">Toutes les catégories</option>
                                <option value="Backend">Backend</option>
                                <option value="Monitoring">Monitoring</option>
                                <option value="Automation">Automation</option>
                                <option value="Proxy">Proxy</option>
                                <option value="Other">Autres</option>
                            </select>
                            <select id="service-selector" class="service-selector">
                                <option value="">Sélectionner un service...</option>
                            </select>
                            <button id="refresh-services" class="btn btn-sm">
                                <i data-lucide="refresh-cw" size="14"></i>
                                <span>Rafraîchir</span>
                            </button>
                        </div>
                    </div>

                    <!-- Service Details View -->
                    <div id="service-detail-view" class="service-detail-view" style="display: none;">
                        <!-- Service Header Card -->
                        <div class="detail-card service-header-card">
                            <div class="service-header-info">
                                <div class="service-icon-large" id="detail-icon">
                                    <i data-lucide="cog" size="32"></i>
                                </div>
                                <div class="service-title-block">
                                    <h3 id="detail-name">Service Name</h3>
                                    <p id="detail-description" class="service-description">Service description</p>
                                    <span id="detail-category" class="badge">Category</span>
                                </div>
                            </div>
                        </div>

                        <!-- Secondary Tabs -->
                        <div class="service-tabs">
                            <button class="service-tab active" data-service-tab="overview">
                                <i data-lucide="layers" size="14"></i>
                                <span>Aperçu</span>
                            </button>
                            <button class="service-tab" data-service-tab="maintenance">
                                <i data-lucide="wrench" size="14"></i>
                                <span>Maintenance</span>
                            </button>
                            <button class="service-tab" data-service-tab="backup">
                                <i data-lucide="archive-restore" size="14"></i>
                                <span>Sauvegarde & logs</span>
                            </button>
                        </div>

                        <!-- Overview Tab Content -->
                        <div class="service-tab-content active" id="service-overview">
                            <div class="detail-grid">
                                <!-- Left Column -->
                                <div class="detail-column">
                                    <div class="detail-card">
                                        <h4><i data-lucide="package" size="16"></i> Conteneurs</h4>
                                        <div id="detail-containers"></div>
                                    </div>
                                    <div class="detail-card">
                                        <h4><i data-lucide="link-2" size="16"></i> URLs & accès</h4>
                                        <div id="detail-urls"></div>
                                    </div>
                                    <div class="detail-card">
                                        <h4><i data-lucide="plug" size="16"></i> Ports exposés</h4>
                                        <div id="detail-ports"></div>
                                    </div>
                                </div>
                                <!-- Right Column -->
                                <div class="detail-column">
                                    <div class="detail-card">
                                        <h4><i data-lucide="key-round" size="16"></i> Identifiants</h4>
                                        <div id="detail-credentials">
                                            <button id="load-creds-btn" class="btn btn-sm">
                                                <i data-lucide="unlock" size="14"></i>
                                                <span>Charger les identifiants</span>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="detail-card">
                                        <h4><i data-lucide="terminal-square" size="16"></i> Commandes rapides</h4>
                                        <div id="detail-commands"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Maintenance Tab Content -->
                        <div class="service-tab-content" id="service-maintenance">
                            <div class="detail-grid">
                                <div class="detail-column">
                                    <div class="detail-card">
                                        <h4><i data-lucide="folder-tree" size="16"></i> Fichiers & chemins</h4>
                                        <div id="detail-paths"></div>
                                    </div>
                                </div>
                                <div class="detail-column">
                                    <div class="detail-card">
                                        <h4><i data-lucide="workflow" size="16"></i> Scripts de maintenance</h4>
                                        <div id="detail-maintenance-commands"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Backup & Logs Tab Content -->
                        <div class="service-tab-content" id="service-backup">
                            <div class="detail-grid">
                                <div class="detail-column">
                                    <div class="detail-card">
                                        <h4><i data-lucide="database-backup" size="16"></i> Sauvegarde & restauration</h4>
                                        <div id="detail-backup-info"></div>
                                    </div>
                                </div>
                                <div class="detail-column">
                                    <div class="detail-card">
                                        <h4><i data-lucide="scroll-text" size="16"></i> Journaux</h4>
                                        <div id="detail-logs"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Empty State -->
                    <div id="service-empty-state" class="empty-state">
                        <div class="empty-state-icon">
                            <i data-lucide="search" size="28"></i>
                        </div>
                        <h3>Sélectionnez un service</h3>
                        <p>Choisissez un service dans le menu déroulant ci-dessus pour voir ses détails, credentials et commandes.</p>
                    </div>
                </div>
            </div>

            <!-- History Tab -->
            <div class="tab-content" id="history-content">
                <div class="history-container">
                    <div class="history-header">
                        <h2>
                            <i data-lucide="history" size="20"></i>
                            <span>Historique des exécutions</span>
                        </h2>
                        <div class="history-filters">
                            <select id="filter-status" class="filter-select">
                                <option value="">Tous les statuts</option>
                                <option value="success">Succès</option>
                                <option value="failed">Échecs</option>
                                <option value="running">En cours</option>
                            </select>
                            <select id="filter-type" class="filter-select">
                                <option value="">Tous les types</option>
                                <option value="deploy">Déploiement</option>
                                <option value="maintenance">Maintenance</option>
                                <option value="test">Tests</option>
                                <option value="utils">Configuration</option>
                            </select>
                            <input type="text" id="search-history" class="search-input" placeholder="Rechercher une exécution...">
                            <button id="refresh-history" class="btn btn-sm">
                                <i data-lucide="refresh-cw" size="14"></i>
                                <span>Rafraîchir</span>
                            </button>
                            <button id="history-share" class="btn btn-sm btn-secondary" title="Copier le lien de cette vue">
                                <i data-lucide="share-2" size="14"></i>
                                <span>Partager</span>
                            </button>
                        </div>
                    </div>

                    <!-- Stats Summary -->
                    <div class="history-stats">
                        <div class="stat-box">
                            <div class="stat-value" id="hist-total">-</div>
                            <div class="stat-label">Total</div>
                        </div>
                        <div class="stat-box success">
                            <div class="stat-value" id="hist-success">-</div>
                            <div class="stat-label">Succès</div>
                        </div>
                        <div class="stat-box failed">
                            <div class="stat-value" id="hist-failed">-</div>
                            <div class="stat-label">Échecs</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="hist-avg-duration">-</div>
                            <div class="stat-label">Durée moy.</div>
                        </div>
                    </div>

                    <!-- Execution Table -->
                    <div id="history-table-container" class="history-table-container">
                        <table class="history-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Script</th>
                                    <th>Pi</th>
                                    <th>Type</th>
                                    <th>Statut</th>
                                    <th>Durée</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="history-table-body">
                                <tr><td colspan="7" class="loading">Chargement de l'historique...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Scheduler Tab -->
            <div class="tab-content" id="scheduler-content">
                <div class="scheduler-container">
                    <div class="scheduler-header">
                        <div class="scheduler-header-left">
                            <h2>
                                <i data-lucide="calendar-check" size="20"></i>
                                <span>Tâches planifiées</span>
                            </h2>
                            <div class="scheduler-filters">
                                <select id="filter-task-pi" class="filter-select">
                                    <option value="">Tous les Pi</option>
                                </select>
                                <select id="filter-task-status" class="filter-select">
                                    <option value="">Tous les états</option>
                                    <option value="enabled">Actives</option>
                                    <option value="disabled">Désactivées</option>
                                </select>
                            </div>
                        </div>
                        <div class="scheduler-header-right">
                            <button id="scheduler-share" class="btn btn-sm btn-secondary" title="Copier le lien de cette planification">
                                <i data-lucide="share-2" size="14"></i>
                                <span>Partager</span>
                            </button>
                            <button id="add-task" class="btn">
                                <i data-lucide="plus" size="16"></i>
                                <span>Nouvelle tâche</span>
                            </button>
                        </div>
                    </div>

                    <!-- Tasks List -->
                    <div id="scheduler-tasks" class="scheduler-tasks">
                        <div class="loading">Chargement des tâches...</div>
                    </div>
                </div>
            </div>

            <!-- SSH Tunnels Tab -->
            <div class="tab-content" id="ssh-tunnels-content">
                <div class="ssh-tunnels-manager">
                    <div class="ssh-tunnels-header">
                        <h2>
                            <i data-lucide="network" size="20"></i>
                            <span>SSH Tunnels</span>
                        </h2>
                        <div class="ssh-tunnels-actions">
                            <button id="refresh-tunnels-btn" class="btn btn-secondary">
                                <i data-lucide="refresh-cw" size="16"></i>
                                <span>Rafraîchir</span>
                            </button>
                            <button id="discover-services-btn" class="btn btn-secondary">
                                <i data-lucide="search" size="16"></i>
                                <span>Découvrir Services</span>
                            </button>
                            <button id="create-tunnel-btn" class="btn btn-primary">
                                <i data-lucide="plus" size="16"></i>
                                <span>Créer un tunnel</span>
                            </button>
                        </div>
                    </div>

                    <!-- Tunnels List -->
                    <div id="ssh-tunnels-list" class="ssh-tunnels-list">
                        <!-- Tunnels will be rendered here by JS -->
                        <div class="empty-state">
                            <i data-lucide="network" size="48"></i>
                            <h3>Chargement des tunnels...</h3>
                            <p>Veuillez patienter</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Database Tab -->
            <div class="tab-content" id="database-content">
                <div class="database-container">
                    <div class="database-header">
                        <h2>
                            <i data-lucide="database" size="20"></i>
                            <span>Supabase Database Setup</span>
                        </h2>
                    </div>

                    <!-- Status Card -->
                    <section class="panel" data-focus="primary">
                        <div class="panel-header">
                            <h3><i data-lucide="info" size="18"></i> Status</h3>
                            <button id="refresh-db-status" class="btn btn-sm">
                                <i data-lucide="refresh-cw" size="14"></i>
                                <span>Rafraîchir</span>
                            </button>
                        </div>
                        <div id="db-status-content" class="db-status-content">
                            <div class="loading">Vérification du status...</div>
                        </div>
                    </section>

                    <!-- Security Audit Card -->
                    <section class="panel" data-focus="primary">
                        <div class="panel-header">
                            <h3><i data-lucide="shield-check" size="18"></i> Security Audit</h3>
                        </div>
                        <div class="db-security-content">
                            <p>Vérifiez la sécurité de votre base de données CertiDoc.</p>
                            <p><strong>Vérifications effectuées :</strong></p>
                            <ul>
                                <li>🔒 Fonctions SECURITY DEFINER sans search_path</li>
                                <li>🛡️ search_path incluant pg_temp</li>
                                <li>⚠️ Politiques RLS potentiellement dangereuses</li>
                                <li>🔍 search_path vide ou mal configuré</li>
                            </ul>
                            <div style="display: flex; gap: 10px; margin-top: 16px;">
                                <button id="run-security-audit" class="btn btn-primary">
                                    <i data-lucide="shield-check" size="18"></i>
                                    <span>Lancer l'Audit Sécurité</span>
                                </button>
                                <button id="view-security-docs" class="btn btn-ghost">
                                    <i data-lucide="book-open" size="18"></i>
                                    <span>Documentation</span>
                                </button>
                            </div>
                            <div id="security-audit-results" class="security-audit-results" style="display: none; margin-top: 16px;">
                                <!-- Results will be populated here -->
                            </div>
                        </div>
                    </section>

                    <!-- Installation Card -->
                    <section class="panel" data-focus="primary">
                        <div class="panel-header">
                            <h3><i data-lucide="play-circle" size="18"></i> Installation</h3>
                        </div>
                        <div class="db-install-content">
                            <p>Installez le schema <code>control_center</code> sur votre base Supabase.</p>
                            <p><strong>Scripts à exécuter :</strong></p>
                            <ul>
                                <li>✅ <code>schema.sql</code> - Tables, indexes, views</li>
                                <li>✅ <code>policies.sql</code> - Row Level Security</li>
                                <li>✅ <code>seed.sql</code> - Migration Pi actuel</li>
                            </ul>
                            <button id="install-db-schema" class="btn btn-primary btn-lg">
                                <i data-lucide="database" size="18"></i>
                                <span>Installer le Schema</span>
                            </button>
                        </div>
                    </section>

                    <!-- Execution Logs -->
                    <section class="panel" data-focus="primary" id="db-logs-panel" style="display: none;">
                        <div class="panel-header">
                            <h3><i data-lucide="terminal" size="18"></i> Logs d'exécution</h3>
                            <button id="clear-db-logs" class="btn btn-sm">
                                <i data-lucide="eraser" size="14"></i>
                                <span>Effacer</span>
                            </button>
                        </div>
                        <div id="db-logs" class="db-logs">
                            <!-- Logs will be populated here -->
                        </div>
                    </section>

                    <!-- Migration Info -->
                    <section class="panel" data-focus="secondary">
                        <div class="panel-header">
                            <h3><i data-lucide="book-open" size="18"></i> Documentation</h3>
                        </div>
                        <div class="db-docs-content">
                            <h4>À propos</h4>
                            <p>Le schema <strong>control_center</strong> permet la gestion multi-Pi dynamique avec :</p>
                            <ul>
                                <li>📊 Table <code>pis</code> - Inventaire Raspberry Pi</li>
                                <li>📦 Table <code>installations</code> - Historique déploiements</li>
                                <li>📈 Table <code>system_stats</code> - Métriques temps réel</li>
                                <li>⏰ Table <code>scheduled_tasks</code> - Tâches planifiées</li>
                            </ul>
                            <h4>Sécurité</h4>
                            <p>Row Level Security (RLS) activé sur toutes les tables. Accès via <code>service_role</code> uniquement.</p>
                            <h4>Migration</h4>
                            <p>Le Pi actuel (<code>pi5</code>) sera automatiquement migré depuis <code>config.js</code>.</p>
                        </div>
                    </section>
                </div>
            </div>

            <!-- Updates Tab -->
            <div class="tab-content" id="updates-content">
                <!-- Content will be created dynamically by updates.js -->
            </div>

            </div>
            <!-- End main-content -->
        </div>
        <!-- End single-column-layout -->
    </div>
    <!-- End container -->

    <!-- Terminal Sidebar (Global) -->
    <aside class="terminal-sidebar" id="terminal-sidebar">
        <section class="panel terminal-panel">
            <div class="panel-header">
                <h2>
                    <i data-lucide="terminal" size="18"></i>
                    <span>Terminal</span>
                </h2>
                <div class="terminal-controls">
                    <button id="new-terminal" class="btn btn-sm btn-primary" title="Nouveau terminal">
                        <i data-lucide="plus-square" size="14"></i>
                    </button>
                    <button id="clear-active-terminal" class="btn btn-sm" title="Nettoyer le terminal actif">
                        <i data-lucide="eraser" size="14"></i>
                    </button>
                    <button id="close-terminal-sidebar" class="btn btn-sm btn-danger" title="Fermer le panneau">
                        <i data-lucide="x" size="14"></i>
                    </button>
                </div>
            </div>

            <!-- Terminal Tabs -->
            <div class="terminal-tabs" id="terminal-tabs">
                <div class="terminal-tab active" data-terminal-id="terminal-1">
                    <span class="terminal-tab-label">Terminal 1</span>
                    <button class="terminal-tab-close" onclick="terminalManager.closeTerminal('terminal-1')" title="Fermer">
                        <i data-lucide="x" size="12"></i>
                    </button>
                </div>
            </div>

            <!-- Terminal Contents -->
            <div class="terminals-container" id="terminals-container">
                <div class="terminal-wrapper active" id="terminal-1" data-terminal-id="terminal-1">
                    <div class="terminal-output">
                        <div class="terminal-line info">🎯 PI5 Control Center - Terminal prêt</div>
                    </div>
                    <div class="terminal-input-wrapper">
                        <span class="terminal-prompt">~$</span>
                        <input type="text" class="terminal-input" placeholder="Saisir une commande et valider..." autocomplete="off" spellcheck="false">
                    </div>
                </div>
            </div>
        </section>
    </aside>

    <!-- Execution Details Modal -->
    <div id="exec-detail-modal" class="modal hidden">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>
                    <i data-lucide="clipboard-list" size="18"></i>
                    <span>Détails de l'exécution</span>
                </h3>
                <button class="modal-close" onclick="hideExecModal()" title="Fermer">
                    <i data-lucide="x" size="16"></i>
                </button>
            </div>
            <div id="exec-detail-content" class="exec-detail-content">
                <!-- Will be populated by JS -->
            </div>
        </div>
    </div>

    <!-- Add Task Modal -->
    <div id="add-task-modal" class="modal hidden">
        <div class="modal-content">
            <h3>
                <i data-lucide="calendar-plus" size="18"></i>
                <span>Nouvelle tâche planifiée</span>
            </h3>
            <form id="add-task-form">
                <div class="form-group">
                    <label>Nom de la tâche</label>
                    <input type="text" id="task-name" class="form-input" required>
                </div>
                <div class="form-group">
                    <label>Script</label>
                    <select id="task-script" class="form-input" required>
                        <option value="">Sélectionner un script...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Pi cible</label>
                    <select id="task-pi" class="form-input" required>
                        <option value="">Sélectionner un Pi...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Expression Cron</label>
                    <input type="text" id="task-cron" class="form-input" placeholder="0 2 * * *" required>
                    <small>Exemples : "0 2 * * *" (2h du matin) | "*/5 * * * *" (toutes les 5 min)</small>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="task-enabled" checked>
                        Activer immédiatement
                    </label>
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn btn-success">
                        <i data-lucide="check" size="16"></i>
                        <span>Créer</span>
                    </button>
                    <button type="button" class="btn btn-danger" onclick="hideAddTaskModal()">
                        <i data-lucide="x" size="16"></i>
                        <span>Annuler</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirm-modal" class="modal hidden">
        <div class="modal-content">
            <h3>
                <i data-lucide="alert-triangle" size="18"></i>
                <span>Confirmer l'exécution</span>
            </h3>
            <p id="confirm-message">Voulez-vous vraiment exécuter ce script ?</p>
            <div class="modal-actions">
                <button id="confirm-yes" class="btn btn-success">
                    <i data-lucide="check" size="16"></i>
                    <span>Exécuter</span>
                </button>
                <button id="confirm-no" class="btn btn-danger">
                    <i data-lucide="x" size="16"></i>
                    <span>Annuler</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Script Info Modal -->
    <div id="script-info-modal" class="modal hidden">
        <div class="modal-content modal-info">
            <div class="modal-header">
                <h3>
                    <i data-lucide="info" size="18"></i>
                    <span id="script-info-title">Informations du script</span>
                </h3>
                <button class="modal-close" id="close-script-info-modal" title="Fermer">
                    <i data-lucide="x" size="18"></i>
                </button>
            </div>
            <div class="modal-body" id="script-info-body">
                <!-- Content will be injected dynamically -->
            </div>
        </div>
    </div>

    <!-- Add Pi Modal -->
    <div id="add-pi-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>
                    <i data-lucide="plus-circle" size="18"></i>
                    <span>Ajouter un nouveau Pi</span>
                </h3>
                <button class="modal-close" id="close-add-pi-modal" title="Fermer">
                    <i data-lucide="x" size="16"></i>
                </button>
            </div>

            <div class="add-pi-content">
                <!-- Step 1: Instructions -->
                <div id="add-pi-step-instructions" class="add-pi-step">
                    <div class="info-box">
                        <i data-lucide="info" size="18"></i>
                        <div>
                            <h4>Comment ajouter un nouveau Pi</h4>
                            <p>Sur votre Raspberry Pi, exécutez la commande suivante :</p>
                        </div>
                    </div>

                    <div class="command-box">
                        <code id="bootstrap-command">curl -fsSL http://localhost:4000/bootstrap | sudo bash</code>
                        <button class="btn-icon" id="copy-bootstrap-cmd" title="Copier">
                            <i data-lucide="copy" size="16"></i>
                        </button>
                    </div>

                    <p class="text-muted">Cette commande va installer les dépendances nécessaires et générer un token de pairing.</p>

                    <div class="modal-actions">
                        <button class="btn btn-primary" id="goto-pairing-step">
                            <span>J'ai exécuté la commande</span>
                            <i data-lucide="arrow-right" size="16"></i>
                        </button>
                    </div>
                </div>

                <!-- Step 2: Token Entry -->
                <div id="add-pi-step-pairing" class="add-pi-step hidden">
                    <div class="form-group">
                        <label>Token de pairing</label>
                        <input type="text" id="pairing-token" class="form-input" placeholder="xxxx-xxxx-xxxx" maxlength="14">
                        <small class="text-muted">Entrez le token affiché sur votre Pi</small>
                    </div>

                    <div id="pairing-status" class="hidden">
                        <!-- Will be populated by JS -->
                    </div>

                    <div class="modal-actions">
                        <button class="btn btn-secondary" id="back-to-instructions">
                            <i data-lucide="arrow-left" size="16"></i>
                            <span>Retour</span>
                        </button>
                        <button class="btn btn-success" id="pair-pi-btn">
                            <i data-lucide="link" size="16"></i>
                            <span>Appairer</span>
                        </button>
                    </div>
                </div>

                <!-- Step 3: Success -->
                <div id="add-pi-step-success" class="add-pi-step hidden">
                    <div class="success-box">
                        <i data-lucide="check-circle" size="48"></i>
                        <h4>Pi appairé avec succès !</h4>
                        <p id="paired-pi-info">--</p>
                    </div>

                    <div class="modal-actions">
                        <button class="btn btn-primary" id="close-success-modal">
                            <i data-lucide="check" size="16"></i>
                            <span>Terminé</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Tunnel Modal -->
    <div id="create-tunnel-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>
                    <i data-lucide="plus" size="18"></i>
                    <span>Créer un tunnel SSH</span>
                </h3>
                <button class="modal-close" onclick="document.getElementById('create-tunnel-modal').classList.add('hidden')" title="Fermer">
                    <i data-lucide="x" size="16"></i>
                </button>
            </div>

            <div class="modal-body">
                <form id="create-tunnel-form">
                    <!-- Service Template -->
                    <div class="form-group">
                        <label>
                            <i data-lucide="layout-template" size="14"></i>
                            <span>Template de service</span>
                        </label>
                        <select id="tunnel-template" name="template" required>
                            <option value="vaultwarden">Vaultwarden</option>
                            <option value="portainer">Portainer</option>
                            <option value="supabase-studio">Supabase Studio</option>
                            <option value="traefik">Traefik Dashboard</option>
                            <option value="custom">Custom</option>
                        </select>
                        <small>Sélectionnez un service prédéfini ou créez un tunnel personnalisé</small>
                    </div>

                    <!-- Tunnel Name -->
                    <div class="form-group">
                        <label>
                            <i data-lucide="tag" size="14"></i>
                            <span>Nom du tunnel</span>
                        </label>
                        <input type="text" id="tunnel-name" name="name" placeholder="Ex: Vaultwarden" required>
                        <small>Un nom descriptif pour ce tunnel</small>
                    </div>

                    <!-- Ports -->
                    <div class="ports-group">
                        <div class="form-group">
                            <label>
                                <i data-lucide="arrow-down-circle" size="14"></i>
                                <span>Port local</span>
                            </label>
                            <input type="number" id="tunnel-local-port" name="localPort" min="1" max="65535" placeholder="8000" required>
                            <small>Port sur votre machine</small>
                        </div>

                        <div class="form-group">
                            <label>
                                <i data-lucide="arrow-up-circle" size="14"></i>
                                <span>Port distant</span>
                            </label>
                            <input type="number" id="tunnel-remote-port" name="remotePort" min="1" max="65535" placeholder="8000" required>
                            <small>Port sur le Pi</small>
                        </div>
                    </div>

                    <!-- Auto Start -->
                    <div class="form-checkbox">
                        <input type="checkbox" id="tunnel-auto-start" name="autoStart">
                        <label for="tunnel-auto-start">Démarrer automatiquement au lancement</label>
                    </div>

                    <!-- Actions -->
                    <div class="modal-actions">
                        <button type="button" class="btn btn-secondary" onclick="document.getElementById('create-tunnel-modal').classList.add('hidden')">
                            <span>Annuler</span>
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i data-lucide="plus" size="16"></i>
                            <span>Créer le tunnel</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Fixed Footer -->
    <footer class="app-footer" id="app-footer">
        <div class="footer-item" id="footer-pi-status">
            <i data-lucide="circle" size="12"></i>
            <span>--</span>
        </div>
        <div class="footer-item">
            <i data-lucide="hash" size="12"></i>
            <span id="footer-version">--</span>
        </div>
        <div class="footer-item">
            <i data-lucide="arrow-up-circle" size="12"></i>
            <span id="footer-uptime">--</span>
        </div>
        <div class="footer-item">
            <i data-lucide="cpu" size="12"></i>
            <span id="footer-cpu">--</span>
        </div>
        <div class="footer-item">
            <i data-lucide="hard-drive" size="12"></i>
            <span id="footer-ram">--</span>
        </div>
    </footer>

    <!-- Sidebar Layout (VS Code style) -->
    <script src="/js/sidebar-layout.js"></script>

    <!-- Modular Architecture (ES6 Modules) -->
    <script type="module" src="/js/main.js"></script>
</body>
</html>
